@using System.Globalization
@using Lunggo.ApCommon.Autocomplete
@using Lunggo.ApCommon.Flight.Constant
@using Lunggo.ApCommon.Flight.Model
@using Lunggo.ApCommon.Trie
@using Lunggo.CustomerWeb.Models
@using Newtonsoft.Json
@model FlightSearchData


@{
    ViewBag.Title = "Hotel Search List";
}

@{
    var parts = Model.info.Split('-');
    var tripPart = parts.First();
    var infoPart = parts.Last();
    var isValid = ((tripPart.Length + 1)%13 == 0) && (infoPart.Length == 4);
    
    List<FlightTripInfo> tripInfos = null;
    FlightSearchData.Complete data = null;
    try
    {
        tripInfos = tripPart.Split('.').Select(info => new FlightTripInfo
        {
            OriginAirport = info.Substring(0, 3),
            DestinationAirport = info.Substring(3, 3),
            DepartureDate = new DateTime(
                2000 + int.Parse(info.Substring(10, 2)),
                int.Parse(info.Substring(8, 2)),
                int.Parse(info.Substring(6, 2)))
        }).ToList();

        data = new FlightSearchData.Complete
        {
            AdultCount = int.Parse(infoPart.Substring(0, 1)),
            ChildCount = int.Parse(infoPart.Substring(1, 1)),
            InfantCount = int.Parse(infoPart.Substring(2, 1)),
            CabinClass = FlightSearchData.ParseCabinClass(infoPart.Substring(3, 1)),
            TripInfos = tripInfos,
            TripType = FlightSearchData.ParseTripType(tripInfos)
        };
    }
    catch
    {
        isValid = false;
    }

    String tripType;
    if (data.TripType == TripType.OneWay)
    {
        tripType = "single";
    }
    else
    {
        tripType = "return";
    }

}

@section AdditionalPageJavascript {}

@section PageJavascript {}

@if (isValid)
{

    <div class="search-page flight-search-page" data-flight-search-params='{ "TripType": "@data.TripType" , "TripInfos" : @JsonConvert.SerializeObject(tripInfos), "AdultCount" : "@data.AdultCount" , "ChildCount" : "@data.ChildCount" , "InfantCount" : "@data.InfantCount", "CabinClass" : "@data.CabinClass" }'>

        <header class="page-header">
            <div class="container">
                <div class="site-nav"> <a href="#">Beranda</a> / <strong>Flight List</strong></div>
                <hr>

            </div>
        </header><!-- .page-header -->
        <div class="container">
            <h2 class="page-title"><b>SEARCH</b> RESULT</h2>
        </div>

        <!-- -->
        <section class="flight-date"></section><!-- .flight-date -->
        <!-- -->

        <aside class="flight-filter filter" data-active="false">
            <div class="filter-button">
                <span class="arrow">&gt;</span>
                <span class="text">FILTER OFF</span>
            </div>
            <header>
                <h3><b>FILTER</b> BY</h3>
            </header>
            <section class="filter-group hotel-price">
                <h3 class="section-title">Harga</h3>
                <input type="text" class="form-control">
            </section>
            <section class="filter-group hotel-star">
                <h3 class="section-title">Bintang Hotel</h3>
                <div class="star-selection">
                    <ul>
                        <li><input type="checkbox" id="filter-hotel-star-1"> <label class="star star-1" for="filter-hotel-star-1"> <span class="fa fa-star"></span> <span class="fa fa-star-o"></span><span class="fa fa-star-o"></span><span class="fa fa-star-o"></span><span class="fa fa-star-o"></span> </label></li>
                        <li><input type="checkbox" id="filter-hotel-star-2"> <label class="star star-2" for="filter-hotel-star-2"> <span class="fa fa-star"></span> <span class="fa fa-star"></span><span class="fa fa-star-o"></span><span class="fa fa-star-o"></span><span class="fa fa-star-o"></span> </label></li>
                        <li><input type="checkbox" id="filter-hotel-star-3"> <label class="star star-3" for="filter-hotel-star-3"> <span class="fa fa-star"></span> <span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star-o"></span><span class="fa fa-star-o"></span> </label></li>
                        <li><input type="checkbox" id="filter-hotel-star-4"> <label class="star star-4" for="filter-hotel-star-4"> <span class="fa fa-star"></span> <span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star-o"></span> </label></li>
                        <li><input type="checkbox" id="filter-hotel-star-5"> <label class="star star-5" for="filter-hotel-star-5"> <span class="fa fa-star"></span> <span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star"></span> </label></li>
                    </ul>
                </div>
            </section>
            <section class="filter-group hotel-discount">
                <ul>
                    <li><input type="checkbox" id="filter-hotel-discount"> <label for="filter-hotel-discount">Punya diskon</label></li>
                </ul>
            </section>
            <section class="filter-group search-filter">
                <a href="#" class="btn btn-primary">FILTER</a>
            </section>
        </aside><!-- .flight-filter -->

        <div class="container" ng-controller="FlightController as flight_list">

            <section class="flight-loading" ng-if="!loaded">
                <img src="/Assets/images/loading-image-dark.gif" />
            </section>

            <section class="flight-list horizontal" ng-if="loaded">

                <!-- Loop start here -->
                <article class="flight flight-single" ng-class="{ 'active': $index == selectedItem }" ng-repeat="flight in flight_list.list">

                    <div class="flight-main">
                        <div class="flight-left">
                            <div class="flight-header">
                                <div class="flight-airline">
                                    <h4>GARUDA INDONESIA</h4>
                                </div>
                            </div><!-- .flight-header -->
                            <div class="flight-content">

                                <div class="flight-airline-image">
                                    <img src="http://placehold.it/100x100.jpg" />
                                </div><!-- .flight-airline-image -->

                                <div class="flight-route">

                                    <div class="departure">
                                        <h2>13:45</h2>
                                        <h3>5 May2015</h3>
                                        <h2>CGK</h2>
                                        <h3>Jakarta</h3>
                                    </div><!-- .departure -->

                                    <div class="duration">
                                        <h5>duration <br /> 10h 51m</h5>
                                        <hr />
                                        <h5>1 stop</h5>
                                    </div><!-- .duration -->

                                    <div class="arrival">
                                        <h2>14:56</h2>
                                        <h3>5 May2015</h3>
                                        <h2>HND</h2>
                                        <h3>Tokyo</h3>
                                    </div><!-- .arrival -->

                                </div><!-- .flight-route -->

                            </div><!-- .flight-content -->
                            <div class="flight-action">
                                <a href="#"><img src="http://placehold.it/25x25.jpg" /> Flight Details</a>
                                <a href="#"><img src="http://placehold.it/25x25.jpg" /> Fares Rules</a>
                            </div><!-- .flight-action -->
                        </div><!-- .flight-left -->
                        <div class="flight-right">
                            <form action="/id/flight/SearchResultList" method="POST">
                                <span class="tag red">Disc 20%</span>
                                <p>Total Fare:</p>
                                <h5 class="price-was"><!-- <del>Rp 1.800.000</del> --></h5>
                                <h4 class="price-now">{{flight.TotalFare | number}}</h4>
                                <small>harga sudah termasuk <b>pajak</b></small>
                                <input class="hidden" type="text" name="itinIndex" value="{{flight.SequenceNo}}" />
                                <input class="hidden" type="text" name="searchId" value="{{FlightSearchParams.SearchId}}" />
                                <button class="btn btn-blue">Book Now !</button>
                            </form>
                        </div><!-- .flight-right -->
                    </div><!-- .flight-main -->

                    <div class="flight-detail">
                        <div class="flight-detail-content">
                            <h4 class="detail-title"> <b>FLIGHT</b> DETAILS</h4>
                            <ol>
                                <li class="route">
                                    <div class="flight-airline">
                                        <img src="http://placehold.it/50.jpg" />
                                        <h5>GA 1234</h5>
                                    </div><!-- .flight-airline-->
                                    <div class="flight-route">
                                        <div class="flight-departure-airport">
                                            <h4>HND</h4>
                                            <h5>Tokyo</h5>
                                            <h5>Haneda International Airport</h5>
                                        </div><!-- .flight-departure-airport -->
                                        <div class="flight-departure-time">
                                            <h4>13:45</h4>
                                            <h5>12 April 2015</h5>
                                        </div><!-- .flight-departure-time -->
                                        <div class="flight-duration">
                                            <h5>Duration<br />10h 59m</h5>
                                            <hr />
                                        </div><!-- .flight-departure-duration -->
                                        <div class="flight-arrival-time">
                                            <h4>14:56</h4>
                                            <h5>13 April 2015</h5>
                                        </div><!-- .flight-arrival-time -->
                                        <div class="flight-arrival-airport">
                                            <h4>CGK</h4>
                                            <h5>Jakarta</h5>
                                            <h5>Soekarno Hatta International Airport</h5>
                                        </div><!-- .flight-departure-airport -->
                                    </div>
                                </li>
                                <li class="transit">
                                    <h3>Change Airplane. Duration 4h 59m</h3>
                                    <h4>Notice:</h4>
                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eu hendrerit nibh, eget consectetur augue. Duis nec scelerisque dolor. Nunc ac dolor at metus suscipit pretium pharetra vitae nulla. Phasellus tristique fermentum dui et dapibus. Praesent tincidunt neque nec justo dapibus condimentum. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec in tristique lacus, nec auctor metus.</p>
                                </li>
                                <li class="route">
                                    <div class="flight-airline">
                                        <img src="http://placehold.it/50.jpg" />
                                        <h5>GA 1234</h5>
                                    </div><!-- .flight-airline-->
                                    <div class="flight-route">
                                        <div class="flight-departure-airport">
                                            <h4>HND</h4>
                                            <h5>Tokyo</h5>
                                            <h5>Haneda International Airport</h5>
                                        </div><!-- .flight-departure-airport -->
                                        <div class="flight-departure-time">
                                            <h4>13:45</h4>
                                            <h5>12 April 2015</h5>
                                        </div><!-- .flight-departure-time -->
                                        <div class="flight-duration">
                                            <h5>Duration<br />10h 59m</h5>
                                            <hr />
                                        </div><!-- .flight-departure-duration -->
                                        <div class="flight-arrival-time">
                                            <h4>14:56</h4>
                                            <h5>13 April 2015</h5>
                                        </div><!-- .flight-arrival-time -->
                                        <div class="flight-arrival-airport">
                                            <h4>CGK</h4>
                                            <h5>Jakarta</h5>
                                            <h5>Soekarno Hatta International Airport</h5>
                                        </div><!-- .flight-departure-airport -->
                                    </div>
                                </li>
                            </ol>
                        </div>
                    </div><!-- .flight-details -->

                </article><!-- .flight -->
                <!-- loop end here -->

            </section><!-- .flght-list -->

        </div><!-- .container -->


    </div>
    <!-- .search-flight -->

}