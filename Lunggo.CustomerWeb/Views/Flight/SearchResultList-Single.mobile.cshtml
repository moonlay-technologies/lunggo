@using Lunggo.ApCommon.Dictionary
@using Lunggo.ApCommon.Flight.Constant
@using Lunggo.ApCommon.Flight.Model
@using Lunggo.ApCommon.Flight.Service
@using Lunggo.CustomerWeb.Models
@using Newtonsoft.Json
@model FlightSearchData


@{
    Layout = "/Views/Shared/mobile/_Layout.cshtml";
    ViewBag.Title = "Flight Search Page";
    ViewBag.BodyClass = "page page-flight single-flight";
    ViewBag.AngularController = "singleFlightController";
}

@{
    bool isValid;

    List<FlightTrip> trips = null;
    FlightSearchData.Complete data = null;
    var originAirportNames = new List<string>();
    var destinationAirportNames = new List<string>();
    var originCityNames = new List<string>();
    var destinationCityNames = new List<string>();
    var originCountryNames = new List<string>();
    var destinationCountryNames = new List<string>();

    String tripType = "aaa";
    try
    {
        var parts = Model.info.Split('-');
        var tripPart = parts.First();
        var infoPart = parts.Last();
        isValid = ((tripPart.Length + 1) % 13 == 0) && (infoPart.Length == 4);

        trips = tripPart.Split('.').Select(info => new FlightTrip
        {
            OriginAirport = info.Substring(0, 3),
            DestinationAirport = info.Substring(3, 3),
            DepartureDate = new DateTime(
                2000 + int.Parse(info.Substring(10, 2)),
                int.Parse(info.Substring(8, 2)),
                int.Parse(info.Substring(6, 2)))
        }).ToList();

        foreach (var trip in trips)
        {
            originAirportNames.Add(DictionaryService.GetInstance().GetAirportName(trip.OriginAirport));
            destinationAirportNames.Add(DictionaryService.GetInstance().GetAirportName(trip.DestinationAirport));
            originCityNames.Add(DictionaryService.GetInstance().GetAirportCity(trip.OriginAirport));
            destinationCityNames.Add(DictionaryService.GetInstance().GetAirportCity(trip.DestinationAirport));
            originCountryNames.Add(DictionaryService.GetInstance().GetAirportCountry(trip.OriginAirport));
            destinationCountryNames.Add(DictionaryService.GetInstance().GetAirportCountry(trip.DestinationAirport));
        }

        data = new FlightSearchData.Complete
        {
            AdultCount = int.Parse(infoPart.Substring(0, 1)),
            ChildCount = int.Parse(infoPart.Substring(1, 1)),
            InfantCount = int.Parse(infoPart.Substring(2, 1)),
            CabinClass = FlightService.ParseCabinClass(infoPart.Substring(3, 1)),
            Trips = trips,
            TripType = FlightService.ParseTripType(trips)
        };

        tripType = data.TripType == TripType.OneWay ? "single" : "return";
    }
    catch
    {
        isValid = false;
    }

}

@section pageJS {
    <script src="/Assets/js/angular.min.js"></script>
}

<form class="hidden" id="pushToken" action="/id/Flight/Select" method="post">
    <input type="text" name="Token" id="fareToken" value="" />
</form>

<section class="flight-summary">
    <div class="summary-left">
        <p><b>Penerbangan Pergi</b><br />
            <b>JKT</b> to <b>DPS</b> - Selasa, 15 Feb 2016
        </p>
    </div>
    <a href="#" class="summary-right"><span>GANTI</span></a>
</section><!-- .flight-summary -->

<section class="flight-sort-filter">
    <div class="flight-sort-filter-action">
        <a href="#">FILTER</a>
        <a href="#">SORT</a>
    </div>
</section><!-- .flight-sort -->

<section class="flight-list">
    
    @for (var i = 1; i <= 10; i++)
    {
        <div class="flight">
            <div class="flight-header">
                <h4 class="flight-airline">
                    <img src="/Assets/images/airlines/GA.png" alt="Alternate Text" class="flight-airline-image" />
                    <span>Garuda Indonesia</span>
                </h4>
            </div>
            <div class="flight-content">
                <div class="content-left">
                    <h4 class="flight-time">
                        <span class="departure">21:35</span>
                        <span class="separator"></span>
                        <span class="arrival">22:35</span>
                        <span class="overday">+1</span>
                    </h4>
                    <h5 class="flight-duration">9h 51m, 1 transit</h5>
                </div>
                <div class="content-right">
                    <label>Harga Total :</label>
                    <h4 class="flight-price">Rp 123.456.789</h4>
                </div>
            </div>
            <div class="flight-footer">
                <a href="#" class="flight-detail-button">Lihat Detail &gt;</a>
                <a href="#" class="btn btn-yellow pull-right flight-order">PESAN</a>
            </div>
        </div>
    }

</section><!-- .flight-list -->

<!-- fullpage popup - flight detail -->
<div class="fullpage-popup fullpage-popup--theme--blue fullpage-popup--flight-detail">
    <header class="fullpage-popup__header">
        <h3 class="fullpage-popup__title">
            DETAIL PENERBANGAN
            <span class="fullpage-popup__close">X</span>
        </h3>
    </header><!-- .fullpage-popup__header -->
    <section class="fullpage-popup__content">
        <div class="flight-title flight-title--departure">
            <div class="flight-info">
                <h4><b>Jakarta</b> to <b>Bali</b></h4>
                <h5>15 Feb 2015</h5>
            </div>
            <a href="#" class="flight-change"><span>GANTI</span></a>
        </div>
        @for (var i = 0; i < 3; i++)
        {
            <div class="flight-wrapper">
                <div class="transit">
                    <span>Transit di Singapore selama <b>02:55:00</b></span>
                </div>
                <div class="flight">
                    <div class="flight__number">
                        <span>1</span>
                    </div>
                    <div class="flight__content">
                        <div class="flight__summary">
                            <img src="/Assets/images/airlines/GA.png" alt="Garuda Indonesia" class="flight__image" />
                            <div class="flight__airline">
                                <h4><b>SINGAPORE AIRLINES</b></h4>
                                <h5>ABC-1234</h5>
                            </div>
                        </div>
                        <div class="flight__detail">
                            <div class="flight__departure">
                                <h5>15 Feb 2015</h5>
                                <h4><b>15:00</b></h4>
                                <h5><b>(BLP) Bandar Lampung</b></h5>
                                <h5>Bandara Hang Sukarno Hattar</h5>
                            </div>
                            <div class="flight__separator"></div>
                            <div class="flight__arrival">
                                <h5>15 Feb 2015</h5>
                                <h4><b>15:00</b></h4>
                                <h5><b>(BLP) Bandar Lampung</b></h5>
                                <h5>Bandara Hang Sukarno Hattar</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

    </section><!-- .fullpage=popup__content -->
    <footer class="fullpage-popup__footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-6">
                    <h5>Harga Total:</h5>
                    <h4><b>Rp 123.456.789</b></h4>
                </div>
                <div class="col-xs-6">
                    <a href="#" class="btn btn-yellow btn-block">PESAN</a>
                </div>
            </div>
        </div>
    </footer><!-- .fullpage-popup__footer -->
</div>

<!-- fullpage popup - filter -->
<div class="fullpage-popup fullpage-popup--flight-filter">
    <header class="fullpage-popup__header">
        <h3 class="fullpage-popup__title">
            FILTER
            <span class="fullpage-popup__close">X</span>
        </h3>
    </header><!-- .fullpagePopup__header -->
    <section class="fullpage-popup__content">
        <div class="filter-group filter-group--price">
            <div class="filter-group__header">
                <h4 class="filter-group__title">Berdasarkan Harga</h4>
            </div>
            <div class="filter-group__content"></div>
        </div>
        <div class="filter-group filter-group--transit">
            <div class="filter-group__header">
                <h4 class="filter-group__title">Berdasarkan Transit</h4>
            </div>
            <div class="filter-group__content">
                <label>
                    Langsung
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    1 kali Transit
                    <input type="checkbox" value="true" />
                </label>
                <label class="control-label">
                    Lebih dari 1
                    <input type="checkbox" value="true" />
                </label>
            </div>
        </div>
        <div class="filter-group filter-group--departure">
            <div class="filter-group__header">
                <h4 class="filter-group__title">Berdasarkan Jam Berangkat</h4>
            </div>
            <div class="filter-group__content">
                <label>
                    Pagi &nbsp; (04.00 - 11:00)
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    Siang &nbsp; (11.00 - 15:00)
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    Sore &nbsp; (15.00 - 19:00)
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    Malam &nbsp; (19.00 - 04:00)
                    <input type="checkbox" value="true" />
                </label>
            </div>
        </div>
        <div class="filter-group filter-group--arrival">
            <div class="filter-group__header">
                <h4 class="filter-group__title">Berdasarkan Jam Tiba</h4>
            </div>
            <div class="filter-group__content">
                <label>
                    Pagi &nbsp; (04.00 - 11:00)
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    Siang &nbsp; (11.00 - 15:00)
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    Sore &nbsp; (15.00 - 19:00)
                    <input type="checkbox" value="true" />
                </label>
                <label>
                    Malam &nbsp; (19.00 - 04:00)
                    <input type="checkbox" value="true" />
                </label>
            </div>
        </div>
        <div class="filter-group filter-group--airline">
            <div class="filter-group__header">
                <h4 class="filter-group__title">Berdasarkan Maskapai</h4>
            </div>
            <div class="filter-group__content">
                <label>
                    <span><img src="/Assets/images/airlines/GA.png" alt="" /> Garuda Indonesia</span>
                    <input type="checkbox" value="true" />
                </label>
            </div>
        </div>
    </section><!-- .fullpagePopup__content -->
</div><!-- .fullpage-popup -->

<!-- .fullpage-popup - sort -->
<div class="fullpage-popup fullpage-popup--flight-sort">
    <header class="fullpage-popup__header">
        <h3 class="fullpage-popup__title">
            FILTER
            <span class="fullpage-popup__close">X</span>
        </h3>
    </header><!-- .fullpagePopup__header -->
    <section class="fullpage-popup__content">
        <label>
            Harga - Rendah ke Tinggi
            <input type="radio" name="name" value="" />
        </label>
        <label>
            Harga - Tinggi ke Rendah
            <input type="radio" name="name" value="" />
        </label>
        <label>
            Nama Maskapai - A ke Z
            <input type="radio" name="name" value="" />
        </label>
        <label>
            Nama Maskapai - Z ke A
            <input type="radio" name="name" value="" />
        </label>
        <label>
            Durasi - Singkat ke Lama
            <input type="radio" name="name" value="" />
        </label>
        <label>
            Durasi - Lama ke Singkat
            <input type="radio" name="name" value="" />
        </label>
    </section><!-- .fullpage-popup__content -->
</div>

<!-- .fullpage-popup - sort -->
<div class="fullpage-popup fullpage-popup--theme--blue fullpage-popup--flight-form">
    <header class="fullpage-popup__header">
        <h3 class="fullpage-popup__title">
            GANTI PENERBANGAN
            <span class="fullpage-popup__close">X</span>
        </h3>
    </header><!-- .fullpagePopup__header -->
    <section class="fullpage-popup__content">
        <form>
            <div class="form-group origin">
                <input type="text" value="" class="form-control" placeholder="Asal" />
            </div>
            <div class="form-group destination">
                <input type="text" value="" class="form-control" placeholder="Tujuan" />
            </div>
            <div class="form-group departure">
                <input type="text" value="" class="form-control" placeholder="Tanggal Pergi" />
            </div>
            <div class="form-group switch-wrapper">
                <span>Pulang Pergi?</span>
                <div class="switch">
                    <label class="control-label active">Ya</label>
                    <label class="control-label">Tidak</label>
                </div>
            </div>
            <div class="form-group return">
                <input type="text" value="" class="form-control" placeholder="Tanggal Pulang" />
            </div>
            <div class="form-group passenger">
                <input type="text" value="" class="form-control" placeholder="Penumpang" />
            </div>
            <div class="form-group submit">
                <button class="btn btn-yellow btn-block">CARI PENERBANGAN</button>
            </div>
        </form>
    </section><!-- .fullpage-popup__content -->
</div><!-- .fullpage-popup--flight-form-->

<!-- popup -->
<div class="popup-wrapper">
    <div class="popup">
        <header class="popup-header">
            <h4 class="popup-title">Roundtrip Flight <span class="close-modal pull-right">X</span></h4>
        </header>
        <div class="popup-content">
            <div class="container">
                <div class="row">
                    <div class="col-xs-4 text-center" style="padding-top:12px;">
                        <img src="/Assets/images/airplane-image.jpg" alt="Airplane" />
                    </div>
                    <div class="col-xs-8">
                        <p>Anda telah memilih penerbangan pergi. <b>Silahkan lanjutkan dengan memilih penerbangan pulang</b></p>
                    </div>
                </div>
            </div>
        </div>
        <footer class="popup-footer">
            <div class="container">
                <div class="row">
                    <div class="col-xs-6">
                        <a href="#" class="btn btn-grey btn-block">KEMBALI</a>
                    </div>
                    <div class="col-xs-6">
                        <a href="#" class="btn btn-yellow btn-block">LANJUT</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div><!-- .modal-wrapper -->

