@{
    Layout = "/Views/Shared/B2BTravorama/_B2BLayout.cshtml";
    ViewBag.BodyClass = "b2b-payment";
    ViewBag.SiteHeader = "b2b-payment";
    ViewBag.Title = "Payment Management";
    ViewBag.AngularController = "B2BPaymentMgmtFormController";
}

@section AdditionalCSS{
    <link href="/Assets/css/jquery-ui.min.css" rel="stylesheet" />
    <!-- fancybox CSS-->
    <link href="/Assets/vendor/fancybox/jquery.fancybox.css" rel="stylesheet" />
}

@section AdditionalJS{
    <script src="/Assets/js/angular.min.js"></script>
    <script src="/Assets/js/angular-route.min.js"></script>
    <script src="/Assets/js/angular-animate.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-resource.js"></script>
    <script src="/Assets/B2BTravorama/assets/js/form_elements.js" type="text/javascript"></script>
    <!-- veritrans JS -->
    <script src="https://api.sandbox.midtrans.com/v2/assets/js/midtrans.min.js" type="text/javascript"></script>
    <!-- fancybox -->
    <script type="text/javascript" src="/Assets/vendor/fancybox/jquery.fancybox.pack.js"></script>
}

@section PageJS{
    <script src="/Assets/travorama20/js/B2BTravorama20.js"></script>
    <script src="/Assets/travorama20/js/B2BPaymentMgmtController.js"></script> 
   
}
<div ng-app="travoramaB2B" ng-controller="B2BPaymentMgmtFormController" ng-class="{ 'active': pageLoaded }" ng-cloak>
    <div class="payment-page">
        <div class="panel panel-transparent">
            <div class="panel-heading">
                <div class="panel-title">
                    Payment Management
                </div>
            </div>
            <div class="panel-heading">
                <div class="panel-title">
                    <p ng-show="BookingStatus.disabled == false">Booking is Enabled </p>
                    <p ng-show="BookingStatus.disabled == true">Booking is Disabled </p>
                    <input class="js-switch" id="BookingStatus" type="checkbox" data-init-plugin="switchery"
                           data-size="small" data-color="primary" data-switchery="true" />
                </div>
            </div>

            <div class="panel-body m-t-10 payment-body">
                <div ng-show="creditCards.length > 0" id="payment-list">
                    <div class="payment-item col-sm-6 m-b-20" id="payment-item-{{$index}}" ng-repeat="cc in creditCards track by $index" count="{{$index}}">
                        <div class="pi-wrapper clearfix">
                            <div class="pi-top clearfix">
                                <div class="logoCard">
                                    <div class="iconCc" style="font-size: 45px;line-height: 100%;height: 46px" ng-show="cc.type== ''"><span><i class="fa fa-credit-card m-r-20"></i></span></div>
                                    <div class="icon-visa" ng-show="cc.type == 'Visa'"></div>
                                    <div class="icon-jcb" ng-show="cc.type=='JCB'"></div>
                                    <div class="icon-amex" ng-show="cc.type == 'American Express'"></div>
                                    <div class="icon-mastercard" ng-show="cc.type =='MasterCard'"></div>
                                </div>
                                <div class="clearfix">
                                    <div class="font-montserrat bold cc-no">{{cc.type}} ****{{cc.maskedCardNumber.slice(-4)}}</div>
                                    <div class="small hint-text expiry">Expires {{("0" + (cc.cardExpiry.getMonth() + 1)).slice(-2)}}/{{cc.cardExpiry.getFullYear().toString().slice(-2)}}</div>
                                </div>
                                <button class="btn remove-payment" ng-class="{ 'disableDel': cc.isPrimaryCard }" ng-hide="cc.isPrimaryCard"
                                        data-toggle="modal" data-target=".deleteCc"
                                        data-backdrop="static" data-keyboard="false" ng-click="deleteCardData.set(cc.maskedCardNumber, $index)" ng-disabled="cc.isPrimaryCard">
                                    <i class="pg-trash"></i>
                                </button>
                            </div>
                            <div class="pi-bottom clearfix font-montserrat bold small">
                                <div class="pi-status"><span class="current-status" ng-show="cc.isPrimaryCard">Primary</span></div>
                                <div class="pi-status">
                                    <a class="set-status" ng-show="!cc.isPrimaryCard" data-toggle="modal" data-target=".setPrimary"
                                       data-backdrop="static" data-keyboard="false" ng-click="setPrimaryData(cc.maskedCardNumber, $index)">Set As Primary Card</a>
                                </div>
                                <div class="pull-right"><a href="#" class="btn-edit-payment hide">Edit</a></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-item col-sm-6 m-b-20 emptyCc" id="payment-item-0" count="0" hidden>
                    <div class="pi-wrapper clearfix">
                        <div class="pi-top clearfix">
                            <div class="logoCard">
                                <div class="iconCc hide" style="font-size: 45px;line-height: 100%;height: 46px"><span><i class="fa fa-credit-card m-r-20"></i></span></div>
                                <div class="icon-visa hide"></div>
                                <div class="icon-jcb hide"></div>
                                <div class="icon-amex hide"></div>
                                <div class="icon-mastercard hide"></div>
                            </div>
                            <div class="clearfix">
                                <div class="font-montserrat bold cc-no">New Credit Card</div>
                                <div class="small hint-text expiry">Expires mm/yy</div>
                            </div>
                            <button class="btn remove-payment" data-toggle="modal" data-target=".deleteCc" data-backdrop="static" data-keyboard="false">
                                <i class="pg-trash"></i>
                            </button>
                        </div>
                        <div class="pi-bottom clearfix font-montserrat bold small">
                            <div class="pi-status"><span class="current-status" ng-show="cc.isPrimaryCard">Primary</span></div>
                            <div class="pi-status">
                                <a class="set-status" ng-show="!cc.isPrimaryCard" data-toggle="modal" data-target=".setPrimary"
                                   data-backdrop="static" data-keyboard="false">Set As Primary Card</a>
                            </div>
                            <div class="pull-right"><a href="#" class="btn-edit-payment hide">Edit</a></div>
                        </div>
                    </div>
                </div>

                <div class="payment-add col-sm-6 m-b-20" ng-click="addCc()">
                    <div class="pa-wrapper clearfix">
                        <a class="font-montserrat bold" id="add-payment"><i class="fa fa-plus-square m-r-5"></i>ADD PAYMENT METHOD</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up firstCc modal-edit-payment" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog ">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix text-left">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            <i class="pg-close fs-14"></i>
                        </button>
                        <h5 class="p-b-10">Add New <span class="semi-bold">Credit Card</span></h5>
                    </div>
                    <div class="modal-body">
                        <form role="form">
                            <div class="form-group-attached">
                                <div class="row">
                                    <div class="col-sm-12 clearfix m-b-10">
                                        <div class="icon-default font-montserrat bold">
                                            <i class="fa fa-credit-card m-r-10 creditCardNo" maxlength="19" placeholder="412356789123456"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group form-group-default">
                                            <label>MM</label>
                                            <input type="text" class="form-control creditCardMonth" ng-model="currentEdit.month" placeholder="01">
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group form-group-default">
                                            <label>YY</label>
                                            <input type="text" class="form-control creditCardYear" ng-model="currentEdit.year" placeholder="2020">
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group form-group-default">
                                            <label>CVC</label>
                                            <input type="text" class="form-control creditCardCvc" ng-model="currentEdit.cvc" placeholder="123">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group form-group-default">
                                            <label>Nama Pengguna</label>
                                            <input type="text" class="form-control creditCardName" ng-model="currentEdit.cardHolderName">
                                        </div>
                                    </div>
                                </div>
                                <div class="row hidden">
                                    <div class="col-sm-12">
                                        <div class="form-group form-group-default">
                                            <label>Alamat</label>
                                            <textarea type="text" class="form-control"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="row">
                            <div class="col-sm-12">
                                <p>Anda akan dikenakan biaya Rp 10.000 yang akan dikembalikan untuk setiap penyimpanan kartu kredit baru.</p>
                            </div>
                        </div>
                        <div class="clearfix m-t-10">
                            <button type="button" class="btn btn-primary m-t-5 pull-right" data-dismiss="modal"><i class="fa fa-save m-r-10"></i>Simpan</button>
                            <button type="button" class="btn btn-default m-t-5 m-r-10 pull-right" data-dismiss="modal"><i class="fa fa-arrow-left m-r-10"></i>Kembali</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-edit-payment form-add-cc" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog ">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix text-left">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            <i class="pg-close fs-14"></i>
                        </button>
                        <h5 class="p-b-10">Add New <span class="semi-bold">Credit Card</span></h5>
                    </div>
                    <div class="modal-body">
                        <form role="form">
                            <div class="form-group-attached">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group form-group-default">
                                            <label>Nomor Kartu Kredit</label>
                                            <textarea type="text" class="form-control creditCardNo" ng-model="currentEdit.cc" maxlength="19" placeholder="412356789123456"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group form-group-default">
                                            <label>MM</label>
                                            <input type="text" class="form-control creditCardMonth" ng-model="currentEdit.month" placeholder="01" maxlength="2">
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group form-group-default">
                                            <label>YY</label>
                                            <input type="text" class="form-control creditCardYear" ng-model="currentEdit.year" placeholder="2021" maxlength="4">
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group form-group-default">
                                            <label>CVC</label>
                                            <input type="text" class="form-control creditCardCvc" ng-model="currentEdit.cvc" placeholder="123">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group form-group-default">
                                            <label>Nama Pengguna</label>
                                            <input type="text" class="form-control creditCardName" ng-model="currentEdit.cardHolderName" placeholder="John Smith">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="row">
                            <div class="col-sm-12">
                                <p>Anda akan dikenakan biaya Rp 10.000 yang akan dikembalikan untuk setiap penyimpanan kartu kredit baru.</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 m-t-10 sm-m-t-10">
                                <button type="button" class="btn btn-default btn-cons btn-block m-t-5" data-dismiss="modal">Kembali</button>
                            </div>
                            <div class="col-sm-6 m-t-10 sm-m-t-10">
                                <button type="button" class="btn btn-primary btn-block m-t-5 saveNewCc">Simpan</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-double setPrimary" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10">
                        <div class="modal-notif-content m-b-20 text-left">
                            Apakah Anda yakin?
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-default btn-block answer" id="yes" data-dismiss="modal" ng-click="setPrimary(ccToSetPrimary, primaryIndex)">Ya</button>
                            </div>
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-primary btn-block answer" id="no" data-dismiss="modal">Tidak</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-default wait" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10">
                        <div class="modal-notif-content m-b-20">
                            Mohon Tunggu
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single setPrimarySucceed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Pengaturan Kartu Kredit Utama Berhasil
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single setPrimaryFailed" tabindex="-1" role="dialog" aria-hidden="false"
         ng-show="!successSetPrimary && finishSetPrimary">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Pengaturan Kartu Kredit Utama Gagal
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-double deleteCc" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10">
                        <div class="modal-notif-content m-b-20 text-left">
                            Apakah Anda yakin?
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-default btn-block answer" id="yes" data-dismiss="modal" ng-click="deleteCard(deleteCardData.cc, deleteCardData.index)">Ya</button>
                            </div>
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-primary btn-block answer" id="no" data-dismiss="modal" ng-click="deleteCardData.cc =''">Tidak</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single deleteCcSucceed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Kartu Kredit Anda berhasil dihapus.
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single deleteCcFailed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Kartu Kredit Anda gagal dihapus
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single addCcSucceed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Kartu Kredit Anda berhasil disimpan.
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single addCcFailed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Kartu Kredit Anda gagal disimpan
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single setBookingStatusSucceed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left" ng-if="BookingStatus.disabled == true">
                            Booking system is successfully disabled.
                        </div>
                        <div class="modal-notif-content m-b-20 text-left" ng-if="BookingStatus.disabled == false">
                            Booking system is successfully enabled.
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-single setBookingStatusFailed" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10 text-center">
                        <div class="modal-notif-content m-b-20 text-left">
                            Updating booking system is failed
                        </div>
                        <button type="button" class="btn btn-primary btn-cons answer" id="close" data-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade slide-up disable-scroll modal-sm-double setBookingStatus" tabindex="-1" role="dialog" aria-hidden="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content-wrapper">
                <div class="modal-content">
                    <div class="modal-header clearfix">
                        <h4 class="text-center no-margin"></h4>
                    </div>
                    <div class="modal-body m-t-10">
                        <div class="modal-notif-content m-b-20 text-left">
                            Apakah Anda yakin?
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-default btn-block answer" id="yes" data-dismiss="modal" ng-click="BookingStatus.set(BookingStatus.state)">Ya</button>
                            </div>
                            <div class="col-xs-6">
                                <button type="button" class="btn btn-primary btn-block answer" id="no" data-dismiss="modal">Tidak</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>