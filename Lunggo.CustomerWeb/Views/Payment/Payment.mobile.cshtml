@using System.Globalization
@using Lunggo.ApCommon.Flight.Constant
@using Lunggo.ApCommon.Flight.Model
@using Lunggo.ApCommon.Hotel.Model
@using Lunggo.ApCommon.Hotel.Service
@using Lunggo.ApCommon.Identity.Users
@using Lunggo.ApCommon.Payment.Constant
@using Lunggo.Framework.Context
@using Lunggo.Framework.Extension
@using Lunggo.Framework.Config
@model Lunggo.CustomerWeb.Models.PaymentData

@{

    var rsvNo = "";
    var todayDate = new DateTime(2017, 3, 25);
    var orderedRooms = new List<Tuple<string, int>>();
    var totalAdult = 0;
    var totalChild = 0;
    var totalRoom = 0;
    var night = 0;
    var images = new List<Image>();
    var hotelImg = "";
    var roomImg = "";
    var listAges = new List<int>();
    try
    {
        if (Model.Reservation is HotelReservationForDisplay)
        {
            var rsv = (Model.Reservation as HotelReservationForDisplay);
            night = (rsv.HotelDetail.CheckOutDate - rsv.HotelDetail.CheckInDate).Days;
            images = HotelService.GetInstance().GetHotelDetailFromDb(rsv.HotelDetail.HotelCode).ImageUrl;
            var orDefault = images.Where(i => i.Type == "GEN").ToList().FirstOrDefault();
            if (orDefault != null)
            {
                hotelImg = images == null
                    ? null
                    : "https://photos.hotelbeds.com/giata/" + orDefault.Path;
            }
            var firstOrDefault = images.Where(i => i.Type == "HAB").ToList().FirstOrDefault();
            if (firstOrDefault != null)
            {
                roomImg = images == null
                    ? null
                    : "https://photos.hotelbeds.com/giata/" + firstOrDefault.Path;
            }
            var rooms = rsv.HotelDetail.Rooms;
            rsvNo = Model.RsvNo;
            foreach (var room in rsv.HotelDetail.Rooms)
            {
                var roomName = room.RoomName;
                var sum = 0;

                foreach (var rate in room.Rates)
                {

                    foreach (var config in rate.Breakdowns)
                    {
                        sum += config.RateCount;
                        totalRoom += config.RateCount;
                        totalAdult += config.AdultCount;
                        totalChild += config.ChildCount;
                        if (config.ChildCount <= 0)
                        {
                            continue;
                        }
                        listAges.AddRange(config.ChildrenAges);
                    }

                }
                orderedRooms.Add(new Tuple<string, int>(roomName, sum)); ;
            }
        }

    }
    catch
    {
        ViewBag.Message = "BookExpired";
    }
}

@{
    Layout = "/Views/Shared/mobile/_LayoutMobile.cshtml";
    ViewBag.BodyClass = "page page-checkout";
    ViewBag.AngularController = "paymentController";
    ViewBag.SiteHeader = "Payment";
    ViewBag.Title = "Pembayaran";
}

@section AdditionalCSS {
    <link href="/Assets/css/jquery-ui.min.css" rel="stylesheet" />
    <!-- fancybox CSS-->
    <link href="/Assets/vendor/fancybox/jquery.fancybox.css" rel="stylesheet" />
    <link rel="stylesheet" href="/Assets/mobile/css/style_mobile.css">
}
@section AdditionalJS {
    <!-- additional Angular JS-->
    <script src="/Assets/js/jquery.countdown.min.js"></script>
    <script src="/Assets/js/CryptoJS/components/core-min.js"></script>
    <script src="/Assets/js/CryptoJS/rollups/sha512.js"></script>
    <script src="/Assets/js/CryptoJS/components/enc-base64-min.js"></script>
    <!-- veritrans JS -->
    <script src=@(ConfigManager.GetInstance().GetConfigValue("veritrans", "endPoint") + "/v2/assets/js/midtrans.min.js")></script>
    <!-- fancybox -->
    <script type="text/javascript" src="/Assets/vendor/fancybox/jquery.fancybox.pack.js"></script>
}
@section PageJS{
    <script>
        var langCode = 'en';
        var paymentTimeout = '';
        // development only start
        paymentTimeout = new Date('@Model.TimeLimit.ToString("yyyy-MM-dd'T'HH:mm:ss'Z'")');
        console.log("TIME OUT: "+ paymentTimeout);
        // countdown timer
        $('.timer').countdown(paymentTimeout, function(event) {
            $('.timer .hour').text(event.strftime('%H'));
            $('.timer .minute').text(event.strftime('%M'));
            $('.timer .second').text(event.strftime('%S'));
        });

        // date selector
        $('.date-picker').datepicker({
            minDate: new Date()
        });
        var langCode = '@OnlineContext.GetActiveLanguageCode()';
        var currentPage = 1;
        // messages
        var message = '@ViewBag.Message';
        // flight detail
        var rsvNo = @Model.RsvNo;
        var paymentDetail = '';
        var flightDetail = '';
        var trips = '';
        var price = '';
        var originalPrice = '';
        var nights = '';
        @if (Model.Reservation is FlightReservationForDisplay)
    {
        var reservation = Model.Reservation as FlightReservationForDisplay;
        @:trips = @Html.Raw(reservation.Itinerary.Trips.Serialize());
        @:price = @reservation.Itinerary.NetTotalFare;
        @:originalPrice = '@reservation.Itinerary.OriginalTotalFare';
    }
    else
    {
        var reservation = Model.Reservation as HotelReservationForDisplay;
        @:hotelDetails = @Html.Raw(reservation.HotelDetail.Serialize());
        @:price = @reservation.HotelDetail.NetTotalFare;
        @:originalPrice = '@reservation.HotelDetail.OriginalTotalFare';
    }
        var redirectionUrl;
        @if (Model.Reservation.Payment.RedirectionUrl != null) {
        @:redirectionUrl = '@Model.Reservation.Payment.RedirectionUrl';
    }
    
        @if (Model.Reservation is FlightReservationForDisplay)
    {
        @:var departureDate;
        var reservation = Model.Reservation as FlightReservationForDisplay;
        if (reservation.Itinerary.Trips != null)
        {
            if (reservation.Itinerary.Trips.Count == 2)
            {
                @:departureDate = '@reservation.Itinerary.Trips[1].DepartureDate';
            }
            else
            {
                @:departureDate = '@reservation.Itinerary.Trips[0].DepartureDate';
            }
        }

        if (reservation.Itinerary.TripType.GetValueOrDefault() == TripType.RoundTrip)
        {
            @:var gtmReturningDepartureDate = '@reservation.Itinerary.Trips[1].DepartureDate.GetValueOrDefault().ToString("yyyyMMdd")';
            @:var gtmReturningArrivalDate = '@reservation.Itinerary.Trips[1].Segments.Last().ArrivalTime.GetValueOrDefault().ToString("yyyyMMdd")'
        }
        @:var gtmContentType = 'flight';
        @:var gtmDepartingDepartureDate = '@reservation.Itinerary.Trips[0].DepartureDate.GetValueOrDefault().ToString("yyyyMMdd")';
        @:var gtmDepartingArrivalDate = '@reservation.Itinerary.Trips[0].Segments.Last().ArrivalTime.GetValueOrDefault().ToString("yyyyMMdd")';
        @:var gtmOriginAirport = '@reservation.Itinerary.Trips[0].OriginAirport';
        @:var gtmDestinationAirport = '@reservation.Itinerary.Trips[0].DestinationAirport';
        @:var gtmNumAdults = @reservation.Itinerary.AdultCount;
        @:var gtmNumChildren = @reservation.Itinerary.ChildCount;
        @:var gtmNumInfants = @reservation.Itinerary.InfantCount;
        @:var gtmTravelClass = '@reservation.Itinerary.RequestedCabinClass.ToString().ToLower()';
        @:var gtmPurchaseValue = @reservation.Itinerary.NetTotalFare;
        @:var gtmPurchaseCurrency = 'IDR';
        @:var gtmPageName = 'payment';
    }
        @if (Model.Reservation is HotelReservationForDisplay)
    {
        var hotel = Model.Reservation as HotelReservationForDisplay;
        @:originalPrice = '@hotel.HotelDetail.OriginalTotalFare';
        @:price = '@hotel.HotelDetail.NetTotalFare';
        @:var gtmContentType = 'hotel';
        @:var gtmCity = '@hotel.HotelDetail.DestinationName';
        @:var gtmHotelIds = '@hotel.HotelDetail.HotelCode';
        @:var gtmRegion = '@hotel.HotelDetail.DestinationName';
        @:var gtmCountry = '@hotel.HotelDetail.CountryName';
        @:var gtmCheckinDate = '@hotel.HotelDetail.CheckInDate.ToString("yyyyMMdd")';
        @:var gtmCheckoutDate = '@hotel.HotelDetail.CheckOutDate.ToString("yyyyMMdd")';
        @:var gtmNumAdults = @totalAdult;
        @:var gtmNumChildren = @totalChild;
        @:var gtmPurchaseCurrency = 'IDR';
        @:var gtmPurchaseValue = @hotel.HotelDetail.NetTotalFare;
        @:var gtmPageName = 'payment';
    }
        // change current page
        if (getParam('page') == 4) {
            currentPage = getParam('page');
        } else {
            currentPage = 1;
        }
        var loggedIn = @User.Identity.IsAuthenticated.ToString().ToLower();
        var buyerInfo = {
            fullname : '@(User.Identity.GetFirstName() + " " + User.Identity.GetLastName())',
            countryCode : '@User.Identity.GetCountryCd()',
            phone: '@User.Identity.GetPhoneNumber()',
            email: '@User.Identity.GetEmail()'
        };
        var langCode = '@OnlineContext.GetActiveLanguageCode()';

        var expirytime = '@Model.TimeLimit.ToString("yyyy-MM-dd'T'HH:mm:ss'Z'")';
    </script>
    <!-- angular controller -->
    <script src="/Assets/travorama20/js/paymentController.js"></script>
}

@switch ((string)ViewBag.Message)
{
    default:
        <!-- payment start here -->

        <div ng-app="travorama" @*ng-controller="paymentController"*@ ng-class="{'page-loaded' : pageLoaded}">
            <section class="checkout-content">

                <div class="page__body" id="step-4">
                    <!-- <div class="summary summary--price">
                        <h3 class="summary__title"><b>RINCIAN</b> HARGA</h3>
                        <div class="summary__body">

                            <dl>
                                @if (Model.Reservation is FlightReservationForDisplay)
                                {
                                    <dt>Harga Tiket</dt>
                                }
                                @if (Model.Reservation is HotelReservationForDisplay)
                                {
                                    <dt>Harga Kamar</dt>
                                }
                                <dd><sup>Rp</sup> {{originalPrice | number}}</dd>
                            </dl>
                            <dl>
                                <dt>Diskon Travorama</dt>
                                <dd ng-if="!((binDiscount.replaceDiscount || methodDiscount.replaceDiscount) && !voucher.confirmedCode)">- <sup>Rp</sup> {{originalPrice - totalPrice| number}}</dd>
                                <dd ng-if="(binDiscount.replaceDiscount || methodDiscount.replaceDiscount) && !voucher.confirmedCode"> <sup>Rp</sup>- 0</dd>
                            </dl>
                            <dl ng-show="voucher.confirmedCode">
                                <dt>{{voucher.displayName}}</dt>
                                <dd><sup>Rp</sup>- {{voucher.amount| number}}</dd>
                            </dl>
                            <dl ng-show="binDiscount.available && !voucher.confirmedCode">
                                <dt>{{binDiscount.displayName}}</dt>
                                <dd><sup>Rp</sup>- {{binDiscount.amount | number}}</dd>
                            </dl>
                            <dl ng-show="methodDiscount.available && !voucher.confirmedCode">
                                <dt>{{methodDiscount.displayName}}</dt>
                                <dd><sup>Rp</sup>- {{methodDiscount.amount | number}}</dd>
                            </dl>
                            <dl>
                                <dt>Kode Unik Pembayaran</dt>
                                <dd><sup>Rp</sup> {{UniqueCodePaymentConfig.UniqueCode | number}}</dd>
                            </dl>
                            <dl class="total-price">
                                <dt>Total</dt>
                                @*<dd><sup>Rp</sup> {{totalPrice - voucher.amount - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode - binDiscount.amount| number}}</dd>*@
                                <dd ng-if="!binDiscount.available && !methodDiscount.available && !voucher.confirmedCode">Rp {{totalPrice - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode| number}}</dd>
                                <dd ng-if="voucher.confirmedCode">Rp {{totalPrice - voucher.amount - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode| number}}</dd>
                                <dd ng-if="binDiscount.available && binDiscount.replaceDiscount && !voucher.confirmedCode">Rp {{originalPrice - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode - binDiscount.amount| number}}</dd>
                                <dd ng-if="binDiscount.available && !binDiscount.replaceDiscount && !voucher.confirmedCode">Rp {{totalPrice - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode - binDiscount.amount| number}}</dd>
                                <dd ng-if="methodDiscount.available && methodDiscount.replaceDiscount && !voucher.confirmedCode">Rp {{originalPrice - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode - methodDiscount.amount| number}}</dd>
                                <dd ng-if="methodDiscount.available && !methodDiscount.replaceDiscount && !voucher.confirmedCode">Rp {{totalPrice - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode - methodDiscount.amount| number}}</dd>
                            </dl>
                        </div><!-- .summary__body -->
                    <!--</div> --> <!-- .summar--price -->
                    
                    <div class="rincian-pesanan-hotel">
                        <h3 class="lg-txt"><b>RINCIAN</b> PEMESANAN</h3>
                        <div class="container-rincian-penerbangan">
                            <div class="content-right-payment">
                                <p><b>Sisa Waktu Pembayaran </b>00:00:00</p>
                            </div>
                            <div class="content-right-payment">
                                <div class="row">
                                    <div class="col-xs-12 img-hotel clear-left clear-right"><img src="https://photos.hotelbeds.com/giata/43/431483/431483a_hb_a_002.jpg" /></div>
                                    <div class="col-xs-12 info-penerbangan clear-left clear-right">
                                        <div class="detail-hotel">
                                            <h3>Maven Gunung Sahari</h3>
                                            <div class="star"></div>
                                            <p>Jl. Gunung Sahari II No.6, RT.12/RW.7, Gn. Sahari Sel., Jakarta, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10610</p>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="content-right-payment">
                                <div class="rincian-harga">
                                    <p><b>Check in : </b><span>01 Agustus 2017</span></p>
                                    <p><b>Check out : </b><span>02 Agustus 2017</span></p>
                                    <p><b>Malam : </b><span>1 Malam</span></p>
                                    <p><b>Kamar : </b><span>1 Kamar</span></p>
                                    <p><b>Jenis Kamar : </b><span>1 Double Deluxe</span></p>
                                    <p><b>Jumlah Tamu : </b><span>1 Dewasa</span></p>
                                </div>
                            </div>
                            <div class="content-right-payment content-right-payment-edit">
                                <div class="kode-voucher">
                                    <a href="#">Punya kode Voucher ?</a>
                                    <div class="form-group ">
                                        <input type="text" class="form-control form-kode-voucher">
                                    </div>
                                </div>
                                <div class="rincian-harga">
                                    <p><b>Harga Kamar : </b><span>Rp 1.500.000</span></p>
                                    <p><b>Diskon Travorama : </b><span class="diskon">Rp 15.250</span></p>
                                    <p><b>Kode Unik Pembayaran : </b><span>Rp -80</span></p>
                                    <div class="total-harga">
                                        <p><b>TOTAL</b><span>Rp 1.376.761</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> <!-- ini untuk rincian hotel-->
                    
                    <!-- rincian penerbangan-->
                    <div class="rincian-pesanan-penerbangan">
                        <div class="container-rincian-pesanan-penerbangan">
                            <div class="info-reservasi-penerbangan">
                                <div class="row">
                                    <div class="col-xs-6">No. Reservasi: 123456</div>
                                    <div class="col-xs-6 text-right">Sisa Waktu: 02:36:05</div>
                                </div>  
                            </div>
                            <div class="jadwal-penerbangan">
                                <div class="row">
                                    <div class="col-xs-5 detail-airport clear-left"><h3>CGK</h3><span>20 Jul 2017 18.25</span></div>
                                    <div class="col-xs-2 logo-penerbangan clear-left clear-right"><img src="/Assets/mobile/images/rounded-garuda.png" /></div>
                                    <div class="col-xs-5 detail-airport clear-right"><h3>CGK</h3><span>20 Jul 2017 18.25</span></div>
                                </div>
                            </div>
                            <div class="separator-jadwal-penerbangan"></div>
                            <div class="jadwal-penerbangan">
                                <div class="row">
                                    <div class="col-xs-5 detail-airport clear-left"><h3>CGK</h3><span>20 Jul 2017 18.25</span></div>
                                    <div class="col-xs-2 logo-penerbangan clear-left clear-right"><img src="/Assets/mobile/images/rounded-garuda.png" /></div>
                                    <div class="col-xs-5 detail-airport clear-right"><h3>CGK</h3><span>20 Jul 2017 18.25</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="total-biaya">
                        <div class="row">
                            <div class="col-xs-6 "><a data-toggle="modal" href="#myModal">Rincian Penerbangan</a></div>
                            <div class="col-xs-6 text-right"><h3>Rp 1.376.761</h3></div>
                        </div>  
                    </div>
                    <!-- end rincian penerbangan-->
                    
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Rincian Penerbangan</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="container-rincian-penerbangan-modal"> <!-- start modal content-->
                                        <div class="content-right-payment">
                                            <p><b>Sisa Waktu Pembayaran </b>00:00:00</p>
                                            <p><b>Nomor Reservasi : </b>12345678</p>
                                        </div>
                                        <div class="content-right-payment">
                                            <p><b>Penumpang</b></p>
                                            <div class="data-penumpang">
                                                <p>1. Indra</p>
                                            </div>
                                        </div>
                                        <div class="content-right-payment">
                                            <div class="row">
                                                <div class="col-xs-5 logo-maskapai"><img src="/Assets/images/logo-garuda.jpg" /></div>
                                                <div class="col-xs-7 info-penerbangan">
                                                    <div class="detail-airport-modal">
                                                        <p>Keberangkatan</p>
                                                        <h3>Jakarta (CGK) - Bali/Denpasar (DPS)</h3>
                                                        <p>20 Jul 2017</p>
                                                        <p>18:25 - 21.00</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="separator"></div>
                                            <div class="row">
                                                <div class="col-xs-5 logo-maskapai"><img src="/Assets/images/logo-garuda.jpg" /></div>
                                                <div class="col-xs-7 info-penerbangan">
                                                    <div class="detail-airport-modal">
                                                        <p>Kepulangan</p>
                                                        <h3>Jakarta (CGK) - Bali/Denpasar (DPS)</h3>
                                                        <p>20 Jul 2017</p>
                                                        <p>18:25 - 21.00</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="content-right-payment content-right-payment-edit">
                                            <div class="kode-voucher">
                                                <a href="#">Punya kode Voucher ?</a>
                                                <div class="form-group ">
                                                    <input type="text" class="form-control form-kode-voucher">
                                                </div>
                                            </div>
                                            <div class="rincian-harga">
                                                <p><b>Harga Tiket : </b><span>Rp 1.500.000</span></p>
                                                <p><b>Diskon Travorama : </b><span class="diskon">Rp 15.250</span></p>
                                                <p><b>Kode Unik Pembayaran : </b><span>Rp -80</span></p>
                                                <div class="total-harga">
                                                    <p><b>TOTAL</b><span>Rp 1.376.761</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div> <!-- modal content-->
                                </div> <!-- modal body-->
                            </div>
                        </div>
                    </div> <!-- modal rincian perjalanan-->

                    <div class="summary summary--payment">
                        <h3 class="lg-txt"><b>METODE</b> PEMBAYARAN</h3>

                        <div class="payment-wrapper">
                            <div class="row">

                                <div class="box-payment col-xs-12">
                                    <div class="row">
                                        <div class="col-xs-5 clear-left"><img src="/Assets/images/atm.jpg" /></div>
                                        <div class="col-xs-5 not-selected"><p>Bank Transfer</p></div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <h3 class="lg-txt"><b>PILIHAN</b> BANK</h3>
                                    <div class="row box-pilihan-bank">
                                        <div class="col-xs-6 clear-left ">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                        <div class="col-xs-6  clear-left">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                        <div class="col-xs-6 clear-left ">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                        <div class="col-xs-6 clear-left">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="rincian-harga-tambahan">
                                        <div class="content-right-payment content-right-payment-edit">
                                            <div class="kode-voucher">
                                                <a href="#">Punya kode Voucher ?</a>
                                                <div class="form-group ">
                                                    <input type="text" class="form-control form-kode-voucher">
                                                </div>
                                            </div>
                                            <div class="rincian-harga">
                                                <p><b>Harga Tiket : </b><span>Rp 1.500.000</span></p>
                                                <p><b>Diskon Travorama : </b><span class="diskon">Rp 15.250</span></p>
                                                <p><b>Kode Unik Pembayaran : </b><span>Rp -80</span></p>
                                                <div class="total-harga">
                                                    <p><b>TOTAL</b><span>Rp 1.376.761</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="form-bayar">
                                        <p>*Dengan klik tombol ‘Bayar’, Anda telah setuju dengan <a href="#">syarat & ketentuan</a> dan <a href="#">kebijakan privasi</a></p>
                                        <input type="submit" class="btn btn-yellow md-txt lg-btn col-xs-12" value="BAYAR">
                                    </div>
                                </div><!-- .payment -->

                                <div class="box-payment col-xs-12">
                                    <div class="row">
                                        <div class="col-xs-5 clear-left"><img src="/Assets/images/kredit.jpg" /></div>
                                        <div class="col-xs-5 selected clear-left"><p>Kartu Kredit / Debit</p></div>
                                        <div class="col-xs-2 text-center"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <h3 class="lg-txt"><b>DETAIL</b> KARTU KREDIT / DEBIT</h3>
                                    <div class="form-kartu-kredit">
                                        <div class="form-group">
                                            <label>Nomor Kartu</label>
                                            <input type="number" class="form-control">
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-6 clear-left">
                                                <div class="form-group">
                                                    <label>Kadaluarsa</label>
                                                    <select class="form-control">
                                                        <option>Bulan</option>
                                                        <option>Januari</option>
                                                        <option>Februari</option>
                                                        <option>Maret</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-xs-6 clear-right">
                                                <div class="form-group">
                                                    <label>&nbsp;</label>
                                                    <select class="form-control">
                                                        <option>Tahun</option>
                                                        <option>1</option>
                                                        <option>2</option>
                                                        <option>3</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-xs-12 clear-left clear-right">
                                                <div class="form-group">
                                                    <label>CVV Kartu</label>
                                                    <input type="number" class="form-control" placeholder="xxx">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Nama Pemegang Kartu</label>
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="rincian-harga-tambahan">
                                        <div class="content-right-payment content-right-payment-edit">
                                            <div class="kode-voucher">
                                                <a href="#">Punya kode Voucher ?</a>
                                                <div class="form-group ">
                                                    <input type="text" class="form-control form-kode-voucher">
                                                </div>
                                            </div>
                                            <div class="rincian-harga">
                                                <p><b>Harga Tiket : </b><span>Rp 1.500.000</span></p>
                                                <p><b>Diskon Travorama : </b><span class="diskon">Rp 15.250</span></p>
                                                <p><b>Kode Unik Pembayaran : </b><span>Rp -80</span></p>
                                                <div class="total-harga">
                                                    <p><b>TOTAL</b><span>Rp 1.376.761</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="form-bayar">
                                        <p>*Dengan klik tombol ‘Bayar’, Anda telah setuju dengan <a href="#">syarat & ketentuan</a> dan <a href="#">kebijakan privasi</a></p>
                                        <input type="submit" class="btn btn-yellow md-txt lg-btn col-xs-12" value="BAYAR">
                                    </div>
                                </div><!-- .payment -->

                                <div class="box-payment col-xs-12">
                                    <div class="row">
                                        <div class="col-xs-5 clear-left"><img src="/Assets/images/atm.jpg" /></div>
                                        <div class="col-xs-5 not-selected clear-left"><p>Virtual Account</p></div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <h3 class="lg-txt"><b>PILIHAN</b> BANK</h3>
                                    <div class="row box-pilihan-bank">
                                        <div class="col-xs-6 clear-left">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                        <div class="col-xs-6 clear-left">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                        <div class="col-xs-6 clear-left">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                        <div class="col-xs-6 clear-left">
                                            <div class="img-bank"><img src="/Assets/images/mandiri.png" alt="Bank Mandiri"></div>
                                            <div class="nama-bank"><p><b>Bank Mandiri</b></p></div>
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="rincian-harga-tambahan">
                                        <div class="content-right-payment content-right-payment-edit">
                                            <div class="kode-voucher">
                                                <a href="#">Punya kode Voucher ?</a>
                                                <div class="form-group ">
                                                    <input type="text" class="form-control form-kode-voucher">
                                                </div>
                                            </div>
                                            <div class="rincian-harga">
                                                <p><b>Harga Tiket : </b><span>Rp 1.500.000</span></p>
                                                <p><b>Diskon Travorama : </b><span class="diskon">Rp 15.250</span></p>
                                                <p><b>Kode Unik Pembayaran : </b><span>Rp -80</span></p>
                                                <div class="total-harga">
                                                    <p><b>TOTAL</b><span>Rp 1.376.761</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="form-bayar">
                                        <p>*Dengan klik tombol ‘Bayar’, Anda telah setuju dengan <a href="#">syarat & ketentuan</a> dan <a href="#">kebijakan privasi</a></p>
                                        <input type="submit" class="btn btn-yellow md-txt lg-btn col-xs-12" value="BAYAR">
                                    </div>
                                </div><!-- .payment -->

                                <div class="box-payment col-xs-12">
                                    <div class="row">
                                        <div class="col-xs-4 clear-left"><img src="/Assets/images/mandiri.jpg" /></div>
                                        <div class="col-xs-5 not-selected clear-left"><p>Mandiri Clickpay</p></div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <h3 class="lg-txt"><b>DETAIL</b> PEMBAYARAN - <b>MANDIRI CLICKPAY</b></h3>
                                    <div class="form-kartu-kredit">
                                        <div class="form-group">
                                            <label>Nomor Kartu</label>
                                            <input type="number" class="form-control">
                                        </div>
                                        <div class="how-to-pay-mandiri">
                                            <p>Input Token Mandiri (diisi secara berurutan)</p>
                                            <div class="row text-group">
                                                <div class="col-xs-3 clear-left"><b>APPLI</b></div>
                                                <div class="col-xs-9">: 3</div>
                                            </div>
                                            <div class="row text-group">
                                                <div class="col-xs-3 clear-left"><b>Input 1</b></div>
                                                <div class="col-xs-9">: Masukkan Nomor Kartu Terlebih Dahulu</div>
                                            </div>
                                            <div class="row text-group">
                                                <div class="col-xs-3 clear-left"><b>Input 2</b></div>
                                                <div class="col-xs-9">: 436271</div>
                                            </div>
                                            <div class="row text-group">
                                                <div class="col-xs-3 clear-left"><b>Input 3</b></div>
                                                <div class="col-xs-9">: 45796</div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Respon Token Mandiri</label>
                                            <input type="text" class="form-control" placeholder="xxxx">
                                        </div>
                                    </div>
                                <div class="separator-desktop"></div>
                                    <div class="rincian-harga-tambahan">
                                        <div class="content-right-payment content-right-payment-edit">
                                            <div class="kode-voucher">
                                                <a href="#">Punya kode Voucher ?</a>
                                                <div class="form-group ">
                                                    <input type="text" class="form-control form-kode-voucher">
                                                </div>
                                            </div>
                                            <div class="rincian-harga">
                                                <p><b>Harga Tiket : </b><span>Rp 1.500.000</span></p>
                                                <p><b>Diskon Travorama : </b><span class="diskon">Rp 15.250</span></p>
                                                <p><b>Kode Unik Pembayaran : </b><span>Rp -80</span></p>
                                                <div class="total-harga">
                                                    <p><b>TOTAL</b><span>Rp 1.376.761</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <div class="form-bayar">
                                        <p>*Dengan klik tombol ‘Bayar’, Anda telah setuju dengan <a href="#">syarat & ketentuan</a> dan <a href="#">kebijakan privasi</a></p>
                                        <input type="submit" class="btn btn-yellow md-txt lg-btn col-xs-12" value="BAYAR">
                                    </div>
                                </div><!-- .payment -->

                                <div class="box-payment col-xs-12">
                                    <div class="row">
                                        <div class="col-xs-4 clear-left"><img src="/Assets/images/cimb.jpg" /></div>
                                        <div class="col-xs-5 not-selected"><p>CIMB Clicks</p></div>
                                    </div>
                                    <div class="separator-desktop"></div>
                                    <p>Pembayaran CIMB Clicks akan diproses di situs Bank CIMB Niaga. Klik tombol bayar di bawah untuk menyelesaikan pembayaran.</p>
                                    <div class="form-bayar">
                                        <p>*Dengan klik tombol ‘Bayar’, Anda telah setuju dengan <a href="#">syarat & ketentuan</a> dan <a href="#">kebijakan privasi</a></p>
                                        <input type="submit" class="btn btn-yellow md-txt lg-btn col-xs-12" value="BAYAR">
                                    </div>
                                </div><!-- .payment -->

                            </div>

                        </div><!-- .payment-wrapper -->
                    </div><!-- .summary--payment -->
                    @if (!User.Identity.IsAuthenticated || (User.Identity.IsAuthenticated && true /*tambah kredit kart baru*/ ))
                    {
                        <div class="credit-card-form" ng-show="paymentMethod == '@PaymentMethod.CreditCard'">

                            <form name="creditCardForm" novalidate>
                                <h3 id="CreditCard" class="no-spacing"><b>DETAIL </b>KARTU KREDIT/DEBIT</h3>

                                <!-- credit card selector end -->
                                <!-- new credit card start -->
                                <div ng-if="CreditCard.TwoClickToken == 'false'">
                                    <div class="form-group" ng-class="{'has-error' : !checkNumber(CreditCard.Number)}">
                                        <label class="control-label">Nomor Kartu</label>
                                        <input type="text" value="" class="form-control cc-number" maxlength="19" ng-model="CreditCard.Number" ng-blur="binDiscount.check()" ng-change="CreditCardPromo.Check(CreditCard.Number)" ng-class="{'visa' : (CreditCardPromo.Type == 'visa') , 'mastercard' : (CreditCardPromo.Type == 'mastercard') }" ng-required="(paymentMethod == '@PaymentMethod.CreditCard') && (CreditCard.TwoClick == 'false')" />
                                        <div ng-show="!checkNumber(CreditCard.Number)" style="color:red">
                                            Nomor kartu tidak boleh mengandung karakter selain angka
                                        </div>
                                        <div ng-show="binDiscount.text != ''" style="color:green">
                                            {{binDiscount.text}}
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-xs-4" ng-class="{'has-error' : dateOver}">
                                                <label class="control-label">Kadaluarsa</label>
                                                <select class="form-control" ng-model="CreditCard.Month" ng-init=" month = 'Bulan'">
                                                    <option value="{{month.value}}" ng-repeat="month in months" ng-selected="month.value == 0"
                                                            ng-click="CreditCard.Month = month.value">
                                                        {{month.name}}
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-xs-4" ng-class="{'has-error' : dateOver}">
                                                <label class="control-label">&nbsp;</label>
                                                <select class="form-control" ng-model="CreditCard.Year" ng-init="year = 'Tahun'">
                                                    <option value="{{year}}" ng-repeat="year in generateYear()" ng-selected="year  == 'Tahun'"
                                                            ng-click="CreditCard.Year = year">
                                                        {{year}}
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-xs-4" ng-class="{'has-error' : !checkNumber(CreditCard.Cvv)}">
                                                <label class="control-label">CVV Kartu</label>
                                                <input type="password" value="" class="form-control" placeholder="XXX" maxlength="3" ng-model="CreditCard.Cvv" ng-required="paymentMethod == '@PaymentMethod.CreditCard'" />
                                            </div>
                                        </div>

                                        <div ng-show="dateOver" style="color:red">
                                            Tanggal Kadaluarsa harus lebih dari tanggal saat ini.
                                        </div>
                                        <div ng-show="!checkNumber(CreditCard.Cvv)" style="color:red">
                                            CVV tidak boleh mengandung karakter selain angka
                                        </div>
                                    </div>
                                    <div class="form-group" ng-class="{'has-error' : !checkName(CreditCard.Name)}">
                                        <label class="control-label">Nama Pemegang Kartu</label>
                                        <input type="text" value="" class="form-control" size="16" ng-model="CreditCard.Name" ng-required="paymentMethod == '@PaymentMethod.CreditCard'" />
                                        <div ng-show="!checkName(CreditCard.Name)" style="color:red">
                                            Nama tidak boleh mengandung karakter selain alfabet dan spasi
                                        </div>
                                    </div>
                                </div>
                                <!-- new credit card end -->

                            </form>
                        </div>
                <!-- .credit-card-form -->
                        <div class="credit-card-form" ng-show="paymentMethod == '@PaymentMethod.MandiriClickPay'">
                            <div class="form-group">
                                <h3 id="MandiriClickPay"><b>DETAIL</b> PEMBAYARAN - <b>MANDIRI CLICKPAY</b></h3>
                                <div class="form-group" ng-class="{'has-error' : !checkNumber(MandiriClickPay.CardNo)}">
                                    <label class="control-label">Nomor Kartu</label>
                                    <input type="text" value="" class="form-control cc-number" maxlength="19" ng-model="MandiriClickPay.CardNo" />
                                </div>
                                <div ng-show="!checkNumber(MandiriClickPay.CardNo)" style="color:red">
                                    Nomor kartu tidak boleh mengandung karakter selain angka
                                </div>
                                <div class="form-group">
                                    <label class="control-label">Input Token Mandiri &nbsp;<small>(diisi secara berurutan)</small></label>
                                    <div class="form-mandiri-payment">
                                        <ul class="form-row clearfix">
                                            <li class="col-left">APPLI</li>
                                            <li class="col-middle">:</li>
                                            <li class="col-right">3</li>
                                        </ul>
                                        <ul class="form-row clearfix">
                                            <li class="col-left">Input 1</li>
                                            <li class="col-middle">:</li>
                                            <li class="col-right" ng-if="MandiriClickPay.CardNo != null && MandiriClickPay.CardNo.length >= 12">{{MandiriClickPay.CardNo | limitTo:-10}}</li>
                                            <li class="col-right" ng-if="MandiriClickPay.CardNo == null || MandiriClickPay.CardNo.length < 12">Masukkan Nomor Kartu Terlebih Dahulu</li>
                                        </ul>
                                        <ul class="form-row clearfix">
                                            <li class="col-left">Input 2</li>
                                            <li class="col-middle">:</li>
                                            <li class="col-right">{{totalPrice - voucher.amount - CreditCardPromo.Amount + UniqueCodePaymentConfig.UniqueCode}}</li>
                                        </ul>
                                        <ul class="form-row clearfix">
                                            <li class="col-left">Input 3</li>
                                            <li class="col-middle">:</li>
                                            <li class="col-right">@Model.RsvNo.Substring(Model.RsvNo.Length - 5, 5)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="form-group" ng-class="{'has-error' : !checkNumber(MandiriClickPay.Token)}">
                                    <label class="control-label">Respon Token Mandiri</label>
                                    <input type="text" value="" class="form-control cc-number" maxlength="6" placeholder="XXXXXX" ng-model="MandiriClickPay.Token" ng-required="paymentMethod == '@PaymentMethod.MandiriClickPay'" />
                                </div>
                                <div ng-show="!checkNumber(MandiriClickPay.Token)" style="color:red">
                                    Respon token tidak boleh mengandung karakter selain angka
                                </div>
                            </div>
                        </div>

                    }
                    
                    <br />

                    <div ng-show="notifCardLength" style="color:red">
                        Panjang digit kartu harus di antara 12-19 digit.
                    </div>
                    

                    <div class="step-button">

                        

                        <form action="" method="post" name="submitForm" id="rsvno" class="hidden">
                            <input type="text" name="RsvNo" value="" id="rsvno-input" />
                            <input type="text" name="PaymentUrl" value="" id="url-input" />
                        </form>

                    </div>
                </div>
            </section><!-- .checkout-content -->
            <!-- Syarat & Ketentuan -->
            <div class="popup__wrapper" ng-class="{'active' : pay.transfer}">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Syarat dan Ketentuan <br />Bank Transfer</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            <ol>
                                <li>Transfer keseluruhan jumlah harga hingga <b>3 angka terakhir</b> untuk menjaga keamanan transaksi dan dilakukan sebelum batas akhir waktu pembayaran.</li>
                                <li>Transfer antarbank (dari bank yang berbeda) wajib menggunakan metode pembayaran Virtual Account.</li>
                                <li><b>Tidak disarankan</b> melakukan transfer dengan <b>LLG/Kliring/SKNBI</b> karena membutuhkan waktu verifikasi yang lebih lama sehingga memungkinkan pemesanan gagal.</li>
                                
                            </ol>
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="pay.transfer = false;" style="width:100%">KEMBALI</a>
                                </div>
                                <div class="col-xs-6">
                                    <input type="submit" class="btn btn-yellow" ng-click="pay.middle('transfer')" value="SETUJU">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup__wrapper" ng-class="{'active' : pay.virtualAccount }">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Syarat dan Ketentuan Virtual Account</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            <ol>
                                <li>Ada biaya Rp 6.500/transaksi (tidak termasuk di total transaksi) untuk pembayaran melalui jaringan ATM Bersama, Prima, dan Alto. Ini sesuai ketetapan ATM Bersama, Prima, dan Alto, dan dapat berubah sewaktu-waktu.</li>
                                <li>Lakukan pembayaran sebelum batas akhir waktu pembayaran.</li>
                            </ol>
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="pay.virtualAccount = false;">KEMBALI</a>
                                </div>
                                <div class="col-xs-6">
                                    <input type="submit" class="btn btn-yellow" ng-click="pay.middle('virtualAccount')" value="SETUJU">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup__wrapper" ng-class="{'active' : expired}">

                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Waktu Habis</h4>
                    </header>

                    <div class="popup__body tnc-body">
                        <h3>Maaf, waktu pembayaran Anda <b>sudah habis</b></h3>
                        <p>Silakan klik tombol di bawah untuk kembali ke halaman utama.</p>
                    </div>

                    <div class="container_new popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <a class="btn btn-yellow btn-block" href="/">KEMBALI</a>
                            </div>
                        </div>
                    </div>

                </div>
            </div><!-- .page-overlay -->


            <div class="popup__wrapper" ng-class="{'active' : pay.ispaying || pay.go }">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Mohon Tunggu</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            Sedang memproses pilihan Anda.
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup__wrapper" ng-class="{'active' : pay.checked && !pay.isSuccess}">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Mohon Maaf...</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            {{errorMessage}}
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="pay.close()">TUTUP</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup__wrapper" ng-class="{'active' : !pay.inputValid}">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Mohon Maaf...</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            Input yang Anda masukkan tidak valid. Silakan cek kembali.
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="pay.inputValid = true">TUTUP</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="popup__wrapper" ng-class="{'active' : mustSelectBank}">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Anda Belum Memilih Bank</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            Silakan pilih salah satu bank yang tersedia sebelum mengklik tombol Bayar.
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="mustSelectBank = false">TUTUP</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup__wrapper" ng-class="{'active' : pay.continueVoucher}">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Mohon Maaf...</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            {{errorMessage}}
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class=" btn btn-yellow btn-block" ng-click="pay.continuePay('voucher')" ng-show="!pay.clickpay"><b>YA</b></a>

                                </div>
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="pay.continueVoucher = false;" ng-show="!pay.clickpay"><b>TIDAK</b></a>
                                    <a class="btn btn-grey btn-block" ng-click="pay.continueVoucher = false;" ng-show="pay.clickpay"><b>TUTUP</b></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup__wrapper" ng-class="{'active' : pay.continueBIN}">
                <div class="popup">
                    <header class="popup__header">
                        <h4 class="popup__title">Mohon Maaf...</h4>
                    </header>
                    <div class="popup__body tnc-body">
                        <div class="container_new">
                            {{errorMessage}}
                        </div>
                    </div>
                    <div class="popup__footer">
                        <div class="container_new tnc">
                            <div class="row">
                                <div class="col-xs-6">
                                    <a class="btn btn-yellow btn-block" ng-click="pay.continuePay('bin')"><b>YA</b></a>

                                </div>
                                <div class="col-xs-6">
                                    <a class="btn btn-grey btn-block" ng-click="pay.continueBIN = false;"><b>TIDAK</b></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- checkout end here -->
                    break;
    case "BookExpired":
    @:[Ini ceritanya page booking expired]
        break;
    case "BookError":
    @:[Ini ceritanya page kalo input datanya ga bener]
        break;
    case "NoLongerAvailable":
    @:[Ini ceritanya page kalo fare-nya uda ga available lageh]
        break;
    case "InvalidInputData":
    @:[Ini ceritanya page kalo input datanya ga bener]
        break;
}

<script>
    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').focus()
    })
</script>