@using System.Globalization
@using Lunggo.ApCommon.Constant
@using Lunggo.ApCommon.Flight.Model
@using Lunggo.ApCommon.Hotel.Model
@using Lunggo.ApCommon.Hotel.Service
@using Lunggo.ApCommon.Hotel.Wrapper.HotelBeds.Sdk.auto.model
@using Lunggo.ApCommon.Payment.Constant
@using Lunggo.Framework.Extension
@model Lunggo.ApCommon.Product.Model.ReservationForDisplayBase
@{
    Layout = "/Views/Shared/Travorama20/_Layout20150929.cshtml";
    ViewBag.BodyClass = "page-account page-account-profile";
    ViewBag.Title = "Detail Pemesanan";
    ViewBag.PageActiveSection = "order";
}
@{
    var orderedRooms = new List<Tuple<string, int>>();
    var rooms = new List<HotelRoomForDisplay>();
    try
    {

        rooms = (Model as HotelReservationForDisplay).HotelDetail.Rooms;
        var rsvNo = Model.RsvNo;
        foreach (var room in rooms)
        {
            var roomName = HotelService.GetInstance().GetHotelRoom(room.RoomCode).RoomDescId;
            var sum = 0;
            foreach (var rate in room.Rates)
            {
                sum += rate.RoomCount;
            }
            orderedRooms.Add(new Tuple<string, int>(roomName, sum)); ;
        }

    }
    catch
    {

    }
}

@functions{

    public string ToTitleCase(string input)
    {

        var text = "";
        try
        {
            var splittedText = input.Split(' ');
            foreach (var word in splittedText)
            {
                var splittedByStrips = word.Split('-');
                var w = "";
                if (splittedByStrips.Count() != 1)
                {
                    foreach (var part in splittedByStrips)
                    {
                        w += ApplyTitleCase(part) + "-";
                    }
                    text += w.Substring(0, w.Length - 1) + " ";
                }
                else
                {
                    text += word[0] + word.Substring(1, word.Length - 1).ToLower() + " ";
                }
            }

        }
        catch
        {

        }
        return text.Length == 0 ? "" : text.Substring(0, text.Length - 1);
    }

    public string ApplyTitleCase(string input)
    {
        return input[0] + input.Substring(1, input.Length - 1).ToLower();
    }

}
@section AdditionalJS{
    <!-- additional Angular JS-->
    <script src="/Assets/js/angular.min.js"></script>
    <script src="/Assets/js/angular-animate.min.js"></script>
    <script src="/Assets/js/angular-route.min.js"></script>
}

@section PageJS{
    <script>
    var langCode = 'en';
    var rsvNo = @Model.RsvNo;
    @*var orderDate = '@Model.RsvTime.ToString("u")';
    //var refundDate = '@(Model.Payment.Refund != null ? Model.Payment.Refund.Time.ToString("u") : "")';*@
    </script>
    <!-- angular controller -->
    <script src="/Assets/travorama20/js/accountController.js"></script>
}


<div class="container page-loading" ng-app="travorama" ng-class="{'page-loaded' : pageLoaded}" ng-controller="orderDetailController">
    <div class="row">

        <div class="col-xs-3" ng-show="isLogin">
            @Html.Partial("/Views/Shared/travorama20/_SectionUserMenu.cshtml")
        </div>
        <!-- ******************** -->
       
          
            <div class="col-xs-9">
                <section class="account-content">

                    <div class="order-detail">
                        <header class="content-header">
                            <h2>NOMOR PESANAN : <b>@Model.RsvNo</b></h2>
                        </header>
                        <section class="content-body">

                            <div class="info-buyer">
                                <header>
                                    <form action="" method="post" name="submitForm" id="rsvno" class="hidden">
                                        <input type="text" name="RsvNo" value="" id="rsvno-input" />
                                        <input type="text" name="Status" value="" id="message-input" />
                                    </form>
                                    <h4>
                                        <b>INFO PEMESANAN</b>
                                        <button class="pull-right btn btn-yellow" ng-if="isExist" ng-click="submitRsvNo(flight.rsvNo, flight.rsvStatus)">{{ButtonText(flight.rsvStatus,flight.payment.method)}}</button>
                                    </h4>
                                </header>
                                <section>
                                    <div class="form form-horizontal">

                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Nama Pemesan</label>
                                            <div class="col-xs-9">
                                                <p class="form-control-static">@Model.Contact.Name</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Tanggal Pemesanan</label>
                                            <div class="col-xs-9">
                                                <p class="form-control-static">@Model.RsvTime</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Tipe</label>
                                            <div class="col-xs-9">
                                                <p class="form-control-static">Penerbangan</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Harga Pesanan</label>
                                            <div class="col-xs-9">
                                                <p class="form-control-static">Rp @Model.Payment.FinalPrice.ToString("##,###", CultureInfo.CreateSpecificCulture("id-ID"))</p>
                                            </div>
                                        </div>

                                        <div class="form-group" ng-show="flight.payment.method">
                                            <label class="control-label col-xs-3">Metode Pembayaran</label>
                                            <div class="col-xs-9">
                                                <p class="form-control-static">@Model.Payment.Method</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Status Pembayaran</label>
                                            <div class="col-xs-9">
                                                <p class="form-control-static">@Model.Payment.Status</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-xs-3">Penumpang</label>
                                            <div class="col-xs-9">
                                                <ol class="passenger-list">
                                                    @foreach (var pax in Model.Pax)
                                                    {
                                                        <li>
                                                            <div class="row">
                                                                <div class="col-xs-9">
                                                                    <p>@EnumDisplay.Title(pax.Title) @pax.Name</p>
                                                                </div>
                                                                <div class="col-xs-3">
                                                                    <span>@pax.Type</span>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }
                                                    
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div><!-- .info-buyer -->
                           
        @if (Model is FlightReservationForDisplay)
        {
            var rsv = Model as FlightReservationForDisplay;
            <div class="info-flight">
                <header>
                    <h4><b>@Html.I18NString("CW00199")</b></h4>
                </header>
                <section>
                    @foreach (var trip in rsv.Itinerary.Trips)
                    {
                        <div>
                            <div class="flight departure">
                                <p><!--<img src="{{trip.segments[0].airlineLogoUrl}}" alt="trip.segments[0].airlineName" /> <span>{{trip.segments[0].airlineName}}</span>--> </p>
                                <div class="row">
                                    <div class="col-xs-2">
                                        <p>Berangkat :</p>
                                    </div>
                                    <div class="col-xs-9">
                                        <p>@trip.OriginCity - @trip.DestinationCity</p>
                                        <p>@trip.DepartureDate.GetValueOrDefault().ToString("D", CultureInfo.CreateSpecificCulture("id-ID"))</p>
                                    </div>
                                </div>
                            </div>   
                        </div>
                    }
                </section>

            </div><!-- .info-flight -->
        }
                            
             @if (Model is HotelReservationForDisplay)
             {
                 var rsv = Model as HotelReservationForDisplay;
                 var indexroom = 1;
                <div class="rh-container review-hotel page-hotel">
                    <h4><b>DETAIL HOTEL</b></h4>
                    @* <div class="rh-main-title">Detail Hotel</div>*@
                    <div class="rh-content">
                        <div class="rh-row clearfix">
                            <div class="col-left-hotel"><img src="@rsv.HotelDetail.MainImage" alt="Alternate Text" /></div>
                            <div class="col-right-hotel">
                                <div class="blue-txt bold-txt hotel-title-lg md-txt">@ToTitleCase(rsv.HotelDetail.HotelName)</div>
                                <div class="star" ng-show="hotelstar() == 'star'"></div>
                                <div class="star star-2" ng-show="hotelstar() == 'star star-2'"></div>
                                <div class="star star-3" ng-show="hotelstar() == 'star star-3'"></div>
                                <div class="star star-4" ng-show="hotelstar() == 'star star-4'"></div>
                                <div class="star star-5" ng-show="hotelstar() == 'star star-5'"></div>
                                <div class="rh-location">
                                    @ToTitleCase(rsv.HotelDetail.Address), @ToTitleCase(rsv.HotelDetail.ZoneName),
                                    @ToTitleCase(rsv.HotelDetail.DestinationName), @ToTitleCase(rsv.HotelDetail.CountryName)
                                </div>
                                <div class="rh-detail">
                                    <div class="wb-container clearfix">
                                        <div class="wb-left">Check in</div>
                                        <div class="wb-mid">:</div>
                                        <div class="wb-right bold-txt">@rsv.HotelDetail.CheckInDate.ToString("D", CultureInfo.CreateSpecificCulture("id-ID"))</div>
                                    </div>
                                    <div class="wb-container clearfix">
                                        <div class="wb-left">Check out</div>
                                        <div class="wb-mid">:</div>
                                        <div class="wb-right bold-txt">@rsv.HotelDetail.CheckOutDate.ToString("D", CultureInfo.CreateSpecificCulture("id-ID"))</div>
                                    </div>
                                    <div class="wb-container clearfix">
                                        <div class="wb-left">Malam</div>
                                        <div class="wb-mid">:</div>
                                        <div class="wb-right bold-txt">@rsv.HotelDetail.NightCount Malam</div>
                                    </div>
                                    <div class="wb-container clearfix">
                                        <div class="wb-left">Kamar</div>
                                        <div class="wb-mid">:</div>
                                        <div class="wb-right bold-txt">{{totalRoom}} Kamar</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="rh-row">
                            <div class="rh-top clearfix">
                                <div class="col-left-hotel"><img src="/Assets/travorama20/images/Hotel/hotel-md.jpg" alt="Alternate Text" /></div>
                                <div class="col-right-hotel clearfix">
                                    <span class="hotel-facility facility"></span>


                                    @foreach (var room in rooms)
                                    {
                                        var index = 1;

                                        <div class="rh-detail">
                                            <div class="wb-container clearfix">
                                                <div class="wb-left">@indexroom. Jenis Kamar</div>
                                                <div class="wb-mid">:</div>
                                                <div class="wb-right bold-txt">@ToTitleCase(HotelService.GetInstance().GetHotelRoom(room.RoomCode).RoomDescId)</div>
                                            </div>

                                            @foreach (var rate in room.Rates)
                                            {
                                                @index
                                                var pol = 1;
                                                <div class="wb-container clearfix">
                                                    <div class="wb-left">Jumlah Kamar</div>
                                                    <div class="wb-mid">:</div>
                                                    <div class="wb-right bold-txt">@rate.RoomCount Kamar</div>
                                                </div>
                                                <div class="wb-container clearfix">
                                                    <div class="wb-left">Tamu per Kamar</div>
                                                    <div class="wb-mid">:</div>
                                                    <div class="wb-right bold-txt">@(rate.AdultCount + rate.ChildCount) Orang</div>
                                                </div>
                                                <div class="wb-container clearfix">
                                                    <div class="wb-left">Tipe Board</div>
                                                    <div class="wb-mid">:</div>
                                                    <div class="wb-right bold-txt">@ToTitleCase(rate.BoardDescription)</div>
                                                </div>
                                                <div class="wb-container clearfix">
                                                    <div class="wb-left">Rate Comment</div>
                                                    <div class="wb-mid">:</div>
                                                    <div class="wb-right bold-txt">@String.Join(". ", rate.TermAndCondition)</div>
                                                </div>
                                                <div class="wb-container clearfix">
                                                    <div class="wb-left">Ketentuan Pembatalan</div>
                                                    <div class="wb-mid">:</div>
                                                    <div class="wb-right bold-txt">
                                                        @foreach (var policy in rate.Cancellation)
                                                        {
                                                            <div>
                                                                @pol. Biaya pembatalan: Rp @(policy.Fee.ToString("##,###", CultureInfo.CreateSpecificCulture("id-ID")))<br />
                                                                Mulai berlaku: @policy.StartTime.ToString("D", CultureInfo.CreateSpecificCulture("id-ID")) <br />
                                                            </div>
                                                            pol++;
                                                        }
                                                    </div>
                                                </div>

                                                        index++;
                                            }

                                        </div>
                                        <ul class="blue-txt semibold-txt blue-list rh-tnc">
                                            @*<li>Extra bed belum termasuk</li>*@
                                            @*<li>Free cancelation sebelum H-5 tanggal booking</li>*@
                                        </ul>
                                            indexroom++;
                                    }

                                </div>
                            </div>

                        </div>
                    </div>
                </div><!-- .info-hotel -->
             }               
                        </section>
                    </div><!-- .history-content -->

                </section><!-- .account-content -->
            </div>
        
        

    </div>
</div>